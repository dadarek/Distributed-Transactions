<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Distributed Transactions</title>
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="../core/deck.core.css">
	<link rel="stylesheet" href="../extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="../extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="../extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="../extensions/status/deck.status.css">
	<link rel="stylesheet" href="../extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="../extensions/scale/deck.scale.css">
	
	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="../themes/style/web-2.0.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="../themes/transition/horizontal-slide.css">
	
	<script src="../modernizr.custom.js"></script>
</head>

<body class="deck-container">

<!-- Begin slides -->
<section class="slide" id="title-slide">
	<h1>(Distributed) Transactions</h1>
</section>

<section class="slide" id="what-well-cover">
  <h2>What We'll Cover</h2>
	<ol>
		<li><h3>What are Transactions</h3></li>
		<li><h3>ACID Properties</h3></li>
		<li><h3>Local Transactions</h3></li>
		<li><h3>Distributed Transactions</h3></li>
	</ol>
</section>

<section class="slide" id="few-examples">
  <h2>A Few Examples</h2>
	<ol class="slide">
		<li><h3>.........</h3></li>
	</ol>
</section>

<section class="slide" id="acid">
  <h2>ACID</h2>
  <hr />
  <h2>Atomic</h2>
  <h2>Consistent</h2>
  <h2>Isolated</h2>
  <h2>Durable</h2>
</section>

<section class="slide" id="atomic">
  <h2>Atomic</h2>
  <ol>
    <li><h3>All or none</h3></li>
    <li><h3>Castle Siege</h3></li>
    <li><h3>Transfer Money Fail</h3></li>
  </ul>
</section>

<section class="slide" id="consistent">
  <h2>Consistent</h2>
  <ol>
    <li><h3>Varies by context</h3></li>
    <li><h3>No "rules" broken (OK within transaction)</h3></li>
    <li><h3>Plane Reservations</h3></li>
    <li><h3>Easier defined within database (FK's, constraints, UK's)</h3></li>
  </ul>
</section>

<section class="slide" id="isolated">
  <h2>Isolated</h2>
  <ol>
    <li><h3>Nobody can see "in-between" steps</h3></li>
    <li><h3>Concurrency Control</h3></li>
    <li><h3>Depositing Check + Direct Depost</h3></li>
  </ul>
</section>

<section class="slide" id="durable">
  <h2>Durable</h2>
  <ol>
    <li><h3>Once you commit, it sticks</h3></li>
    <li><h3>Sinkholes ...</h3></li>
  </ul>
</section>

<section class="slide" id="isolation-revisited">
  <h2>Isolation (revisited)</h2>
  <ol>
    <li><h3>Trade-offs efficiency v.s. safety</h3></li>
    <li><h3>"Snapshot" isolation</h3></li>
    <li><h3>Isolation levels + Transaction Deadlock victims</h3></li>
  </ul>
</section>

<section class="slide" id="serializable">
  <h2>Serializable <em>(no phantom reads)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        <span class="comment">/* tries update, but is blocked... */</span>
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will still read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        COMMIT
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        update AGE of MEMBER_ID = 1 (SET to 22)
      </td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        <span class="comment">/* do some other stuff ... */</span>
      </td>
    </tr>
  </table>
</section>

<section class="slide" id="repeatable-read">
  <h2>Repeatable Read <em>(no range locks)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read MEMBERS with AGE &gt; 30
        <span class="comment">/* receives 5 records */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        <span class="comment">/* can't touch existing rows ... */</span>
        <span class="comment">/* ... but can add new ones */</span>
        insert MEMBER with AGE = 35
      </td>
    </tr><tr>
      <td class="active">
        read MEMBERS with AGE &gt; 30
        <span class="comment">/* receives 6 records */</span>
        <span class="comment">/* 5 repeatable + 1 phantom */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
</section>

<section class="slide" id="read-commited">
  <h2>Read Commited <em>(non-repeatable reads)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        update AGE = 55 of MEMBER_ID = 1
      </td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some more stuff ... */</span>
      </td>
      <td class="active">
        COMMIT
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will NOW read 55 */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
</section>

<section class="slide" id="read-uncommited">
  <h2>Read Uncommited <em>(dirty)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        update AGE = 55 of MEMBER_ID = 1
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will NOW read 55 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        COMMIT
      </td>
    </tr>
  </table>
</section>

<section class="slide" id="deadlocks">
  <h2>Deadlocks!</h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        update ORDERS
        <span class="comment">/* Locks ORDERS */</span>
      </td>
      <td class="active">
        update MEMBERS
        <span class="comment">/* Locks MEMBERS */</span>
      </td>
    </tr><tr>
      <td class="active">
        update STORE_ITEMS
        <span class="comment">/* Locks STORE_ITEMS */</span>
      </td>
      <td class="active">
        update ORDERS
        <span class="comment">/* <strong>BLOCKED</strong> by Transaction 1 */</span>
      </td>
    </tr><tr>
      <td class="active">
        update MEMBERS
        <span class="comment">/* <strong>BLOCKED</strong> by Transaction 2 */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
  <div class="slide">
    <h2>Random Transaction Victim</h2>
    <h3>Avoid with good concurrency control protocols</h3>
  </div>
</section>

<section class="slide" id="error-recovery">
  <h2>Error Recovery</h2>
  <ol>
    <li><h3><em>Not always possible...</em></h3></li>
    <li><br /><h3>Recover $$$ from ATM Error</h3></li>
    <li><br /><h3>Delete internet cache fail:<br />
      <span style="font-family: calibri">rm -rf&nbsp;&nbsp;/</span></h3></li>
  </ul>
</section>

<section class="slide" id="how-to-overview">
  <h2>TODO</h2>
	<ol>
		<li>
			<h3>Have LESS words in these slides<h3>
			<p>You won't rely on them as much.</p>
		</li>
		<li>
			<h3>Is nesting possible?</h3>
			<p>So one of the nodes is a TM that relays to its own nodes?</p>
		</li>
		<li>
			<h3>Dynamic 2PC</h3>
			<p>Dynamic coordinator, everyone does something and we'll see who was last ...</p>
		</li>
		<li>
			<h3>Compensating Transactions</h3>
			<p>When you tell United + Southwest to commit, you crash, and you never tell Hertz to commit.  Hertz rollsback (after timeout), and you must rollback United + SW with a compensating transaction.</p>
		</li>
		<li>
			<h3>Other Examples</h3>
			<p>Paying bills - t-mobile updates their database &amp; banks database.</p>
		</li>
	</ol>
</section>

<section class="slide" id="how-to-overview">
  <h2>Assumptions</h2>
	<ol>
		<li><h3>Stable storage + write-ahead log</h3></li>
		<li><h3>Write-ahead log is not corrupted (or lost) on crash</h3></li>
		<li><h3>Nobody crashes forever and ever</h3></li>
		<li><h3>Nodes can talk with each other</h3></li>
	</ol>
</section>

<section class="slide" id="how-to-overview">
  <h2>How to decrease locking?</h2>
	<ol>
		<li class="slide">
			<h3>Finer Granularity of Resources</h3>
			<p>(Insert image of coffee beans) So, Flight 333 does not lock when you book Flight 456.</p>
		</li>
	</ol>
</section>
<section class="slide" id="how-to-overview">
  <h2>How to prevent deadlocks?</h2>
	<ol>
		<li class="slide">
			<h3>Lock (and release) in same order</h3>
			<p>This only works if everyone plays this game. (Philosophers fork problem - though not really - here you MUST start on the same lock (can't start in the middle because you'll round robin and still deadlock))</p>
		</li>
	</ol>
</section>

<section class="slide" id="markup">
	<h1>Meet: The Transaction Manager</h1>
</section>

<section class="slide" id="extensions">
	<h2>Serializable Transactions</h2>
	
	<ul>
		<li class="slide" id="extensions-goto">
      To the outside world, each transaction (all it's effects) took place before or after any other transaction.  (No interleaving)
		</li>

		<li class="slide" id="extensions-goto">
      (insert image here of serialized, and not serialized - maybe a stack of blocks that show interleaving and a stack that shows no interleaving - each block would be a step of a transaction).
		</li>

		<li class="slide" id="extensions-goto">
      Read this: http://en.wikipedia.org/wiki/Schedule_(computer_science)
		</li>
	</ul>
	
</section>

<section class="slide" id="elements-blockquotes">
	<h2>Why 2-phase commit can't always apply?</h2>
  <blockquote cite="http://example.org" class="slide">
		<p>Because our background script that processes the orders only runs at midnight.</p>
		<p><cite>Big Important Company</cite></p>
	</blockquote>
</section>


<section class="slide" id="elements-uml-1">
  <p><img src="images/HttpServer.png" style="width: 100%;" /></p>
</section>

<section class="slide" id="elements-uml-2">
  <p><img src="images/HttpConnectionhandler.png" style="width: 100%;" /></p>
</section>

<section class="slide" id="elements-uml-3">
  <p><img src="images/ChartingServer.png" style="width: 100%;" /></p>
</section>

<section class="slide" id="elements-uml-4">
  <p><img src="images/ThreadedConnectionHandler.png" style="width: 100%;" /></p>
</section>

<section class="slide" id="digging-deeper">
	<h2>Thank You</h2>
	<p>If you want to learn about our server, checkout our <a href="https://github.com/dadarek/HTTP-Server">github repo</a>.</p>
</section>

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>


<!-- Grab CDN jQuery, with a protocol relative URL; fall back to local if offline -->
<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.min.js"></script>
<script>window.jQuery || document.write('<script src="../jquery-1.7.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="../core/deck.core.js"></script>
<script src="../extensions/hash/deck.hash.js"></script>
<script src="../extensions/menu/deck.menu.js"></script>
<script src="../extensions/goto/deck.goto.js"></script>
<script src="../extensions/status/deck.status.js"></script>
<script src="../extensions/navigation/deck.navigation.js"></script>
<script src="../extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck -->
<script>
$(function() {
	$.deck('.slide');
});
</script>

</body>
</html>
