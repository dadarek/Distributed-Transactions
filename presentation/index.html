<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Distributed Transactions</title>
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="../core/deck.core.css">
	<link rel="stylesheet" href="../extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="../extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="../extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="../extensions/status/deck.status.css">
	<link rel="stylesheet" href="../extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="../extensions/scale/deck.scale.css">
	
	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="../themes/style/web-2.0.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="../themes/transition/horizontal-slide.css">
	
	<script src="../modernizr.custom.js"></script>
</head>

<body class="deck-container">

<!-- Begin slides -->
<section class="slide" id="title-slide">
	<h1>(Distributed) Transactions</h1>
</section>

<section class="slide" id="what-well-cover">
  <h2>What We'll Cover</h2>
	<ol>
		<li><h3>What are Transactions</h3></li>
		<li><h3>ACID Properties</h3></li>
		<li><h3>2-Phase Commit</h3></li>
		<li><h3>Checkpointing + Logging</h3></li>
	</ol>
</section>

<section class="slide" id="few-examples">
  <h2>A Few Examples</h2>
	<ol class="slide">
		<li><h3>.........</h3></li>
	</ol>
</section>

<section class="slide" id="acid">
  <h2>ACID</h2>
  <hr />
  <h2>Atomic</h2>
  <h2>Consistent</h2>
  <h2>Isolated</h2>
  <h2>Durable</h2>
</section>

<section class="slide" id="atomic">
  <h2>Atomic</h2>
  <ol>
    <li><h3>All or none</h3></li>
    <li><h3>Castle Siege</h3></li>
    <li><h3>Transfer Money Fail</h3></li>
  </ul>
</section>

<section class="slide" id="consistent">
  <h2>Consistent</h2>
  <ol>
    <li><h3>Varies by context</h3></li>
    <li><h3>No "rules" broken (OK within transaction)</h3></li>
    <li><h3>Plane Reservations</h3></li>
    <li><h3>Easier defined within database (FK's, constraints, UK's)</h3></li>
  </ul>
</section>

<section class="slide" id="isolated">
  <h2>Isolated</h2>
  <ol>
    <li><h3>Nobody can see "in-between" steps</h3></li>
    <li><h3>Concurrency Control</h3></li>
    <li><h3>Depositing Check + Direct Depost</h3></li>
  </ul>
</section>

<section class="slide" id="durable">
  <h2>Durable</h2>
  <ol>
    <li><h3>Once you commit, it sticks</h3></li>
    <li><h3>Sinkholes ...</h3></li>
  </ul>
</section>

<section class="slide" id="acid-quiz">
  <h2>Quiz Time</h2>
  <ol>
    <li><h3>"It's pronounced "nucular"</h3></li>
  </ul>
</section>

<section class="slide" id="isolation-revisited">
  <h2>Isolation (revisited)</h2>
  <ol>
    <li><h3>Trade-offs efficiency v.s. safety</h3></li>
    <li><h3>"Snapshot" isolation</h3></li>
    <li><h3>Isolation levels + Transaction Deadlock victims</h3></li>
    <li><h3>Controlled Concurrency: Stand Up</h3></li>
  </ul>
</section>

<section class="slide" id="serializable">
  <h2>Serializable <em>(no phantom reads)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        <span class="comment">/* tries update, but is blocked... */</span>
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will still read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        COMMIT
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        update AGE of MEMBER_ID = 1 (SET to 22)
      </td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        <span class="comment">/* do some other stuff ... */</span>
      </td>
    </tr>
  </table>
</section>

<section class="slide" id="repeatable-read">
  <h2>Repeatable Read <em>(no range locks)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read MEMBERS with AGE &gt; 30
        <span class="comment">/* receives 5 records */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        <span class="comment">/* can't touch existing rows ... */</span>
        <span class="comment">/* ... but can add new ones */</span>
        insert MEMBER with AGE = 35
      </td>
    </tr><tr>
      <td class="active">
        read MEMBERS with AGE &gt; 30
        <span class="comment">/* receives 6 records */</span>
        <span class="comment">/* 5 repeatable + 1 phantom */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
</section>

<section class="slide" id="read-commited">
  <h2>Read Commited <em>(non-repeatable reads)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        update AGE = 55 of MEMBER_ID = 1
      </td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some more stuff ... */</span>
      </td>
      <td class="active">
        COMMIT
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will NOW read 55 */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
</section>

<section class="slide" id="read-uncommited">
  <h2>Read Uncommited <em>(dirty)</em></h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will read 21 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td class="active">
        <span class="comment">/* do some stuff ... */</span>
      </td>
      <td class="active">
        update AGE = 55 of MEMBER_ID = 1
      </td>
    </tr><tr>
      <td class="active">
        read AGE of MEMBER_ID = 1
        <span class="comment">/* will NOW read 55 */</span>
      </td>
      <td>&nbsp;</td>
    </tr><tr>
      <td>&nbsp;</td>
      <td class="active">
        COMMIT
      </td>
    </tr>
  </table>
</section>

<section class="slide" id="deadlocks">
  <h2>Deadlocks!</h2>
  <table class="isolation">
    <tr>
      <th>Transaction 1</th>
      <th>Transaction 2</th>
    </tr><tr>
      <td class="active">
        update ORDERS
        <span class="comment">/* Locks ORDERS */</span>
      </td>
      <td class="active">
        update MEMBERS
        <span class="comment">/* Locks MEMBERS */</span>
      </td>
    </tr><tr>
      <td class="active">
        update STORE_ITEMS
        <span class="comment">/* Locks STORE_ITEMS */</span>
      </td>
      <td class="active">
        update ORDERS
        <span class="comment">/* <strong>BLOCKED</strong> by Transaction 1 */</span>
      </td>
    </tr><tr>
      <td class="active">
        update MEMBERS
        <span class="comment">/* <strong>BLOCKED</strong> by Transaction 2 */</span>
      </td>
      <td>&nbsp;</td>
    </tr>
  </table>
  <div class="slide">
    <h2>Random Transaction Victim</h2>
    <h3>Avoid with good concurrency control protocols</h3>
  </div>
</section>

<section class="slide" id="protocol">
  <h2>def Protocol</h2>
  <ol>
    <li><h3>Diplomatic Meetings</h3></li>
    <li><h3>"Get stuff done"</h3></li>
    <li><h3>Skiing/Shopping</h3></li>
    <li><h3>When things go wrong ...</h3></li>
  </ol>
</section>

<section class="slide" id="one-phase-commit">
  <h2>One-Phase Commit (1PC)</h2>
  <ol>
    <li><h3>Just do it!</h3></li>
  </ol>
</section>

<section class="slide" id="one-phase-commit-whoops">
  <h2>One-Phase Commit - Whoops!</h2>
  <ol>
    <li><h3>What if someone can't commit?</h3></li>
  </ol>
</section>

<section class="slide" id="two-phase-commit">
  <h2>Two-Phase Commit (2PC)</h2>
  <ol>
    <li><h3>Better ...</h3></li>
  </ol>
</section>

<section class="slide" id="two-phase-assumptions">
  <h2>Two-Phase Commit - Assumptions</h2>
  <ol>
    <li><h3>Stable Storage</h3></li>
    <li><h3>Write-Ahead Logging</h3></li>
    <li><h3>No Corruptions</h3></li>
    <li><h3>Nobody dies forever</h3></li>
    <li><h3>Communication between nodes</h3></li>
  </ol>
</section>

<section class="slide" id="two-phase-commit">
  <h2>Stable Storage is 'relative'</h2>
  <ol>
    <li><h3>Redundancy</h3></li>
    <li><h3>Sinkhole</h3></li>
  </ol>
</section>

<section class="slide" id="error-recovery">
  <h2>Error Recovery</h2>
  <ol>
    <li><h3><em>Not always possible...</em></h3></li>
    <li><br /><h3>Recover $$$ from ATM Error</h3></li>
    <li><br /><h3>Delete internet cache fail:<br />
      <span style="font-family: calibri">$ rm -rf&nbsp;&nbsp;/</span></h3></li>
    <li><br /><h3>Compensating Transactions</h3></li>
  </ol>
</section>

<section class="slide" id="checkpointing-logging">
  <h2>Checkpointing + Logging</h2>
  <ol>
    <li><h3>Coordinate Checkpointing</h3></li>
    <li><h3>Optimistic + Pessimistic Logging</h3></li>
  </ol>
</section>

<section class="slide" id="two-phase-na">
  <h2>Two-Phase Commit - Maybe not?</h2>
  <ol>
    <li><h3>Large, Independent Systems</h3></li>
    <li><h3>Asynch - Amazon MWS</h3></li>
    <li><h3>Airline Bookings</h3></li>
  </ol>
</section>

<section class="slide" id="two-phase-problems">
  <h2>Two-Phase Commit - Problems?</h2>
  <ol>
    <li><h3>Coordinator + Node Crash</h3></li>
    <li><h3>What do we do?</h3></li>
    <li><h3>Block</h3></li>
  </ol>
</section>

<section class="slide" id="three-phase">
  <h2>Three-Phase Commit (3PC)</h2>
  <ol>
    <li><h3>Vote (rollback on timeout)</h3></li>
    <li><h3>Prepare (commit on timeout - unless YOU crash)</h3></li>
    <li><h3>Commit</h3></li>
  </ol>
</section>

<section class="slide" id="what-well-cover">
  <h2>What We Just Learned</h2>
	<ol>
		<li><h3>What are Transactions</h3></li>
		<li><h3>ACID Properties</h3></li>
		<li><h3>2-Phase Commit</h3></li>
		<li><h3>Checkpointing + Logging</h3></li>
	</ol>
</section>

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>


<!-- Grab CDN jQuery, with a protocol relative URL; fall back to local if offline -->
<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.min.js"></script>
<script>window.jQuery || document.write('<script src="../jquery-1.7.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="../core/deck.core.js"></script>
<script src="../extensions/hash/deck.hash.js"></script>
<script src="../extensions/menu/deck.menu.js"></script>
<script src="../extensions/goto/deck.goto.js"></script>
<script src="../extensions/status/deck.status.js"></script>
<script src="../extensions/navigation/deck.navigation.js"></script>
<script src="../extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck -->
<script>
$(function() {
	$.deck('.slide');
});
</script>

</body>
</html>
